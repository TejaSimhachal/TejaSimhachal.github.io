<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login / Sign Up</title>
    <link rel="stylesheet" href="common-styles.css">
    <style>
        .container {
            max-width: 400px;
            margin: 50px auto;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
        }
        .form-group input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .submit-btn {
            background-color: var(--primary-color);
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
        }
        .submit-btn:hover {
            background-color: #45a049;
        }
        .toggle-form {
            text-align: center;
            margin-top: 15px;
        }
        .toggle-btn {
            background: none;
            border: none;
            color: #4CAF50;
            text-decoration: underline;
            cursor: pointer;
        }
        .form-container {
            display: none;
        }
        .form-container.active {
            display: block;
        }
        
        /* Add new styles for role selection */
        .role-container {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .role-btn {
            display: inline-block;
            width: 150px;
            margin: 10px;
            padding: 20px;
            border: 2px solid #4CAF50;
            border-radius: 8px;
            background-color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .role-btn:hover {
            background-color: #4CAF50;
            color: white;
        }
        
        .role-btn img {
            width: 64px;
            height: 64px;
            margin-bottom: 10px;
        }
        
        .role-btn p {
            margin: 0;
            font-weight: bold;
        }

        /* Add styles for role selection */
        #roleSelectionForm {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .role-options {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        .role-card {
            border: 2px solid #4CAF50;
            border-radius: 8px;
            padding: 20px;
            width: 150px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .role-card:hover {
            background-color: #4CAF50;
            color: white;
        }

        .role-card img {
            width: 64px;
            height: 64px;
            margin-bottom: 10px;
        }

        .back-btn {
            margin-top: 20px;
            padding: 8px 16px;
            background-color: #666;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #555;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="loginForm" class="form-container active">
            <h2>Login</h2>
            <form id="loginFormElement">
                <div class="form-group">
                    <label for="login-email">Email:</label>
                    <input type="email" id="login-email" name="email" required>
                </div>
                <div class="form-group">
                    <label for="login-password">Password:</label>
                    <input type="password" id="login-password" name="password" required>
                </div>
                <button type="submit" class="submit-btn">Login</button>
            </form>
            <div class="toggle-form">
                <p>Don't have an account? <button class="toggle-btn" onclick="toggleForms()">Sign up</button></p>
            </div>
        </div>

        <div id="signupForm" class="form-container">
            <h2>Sign Up</h2>
            <form>
                <div class="form-group">
                    <label for="signup-fullname">Full Name:</label>
                    <input type="text" id="signup-fullname" name="fullname" required>
                </div>
                <div class="form-group">
                    <label for="signup-email">Email:</label>
                    <input type="email" id="signup-email" name="email" required>
                </div>
                <div class="form-group">
                    <label for="signup-password">Password:</label>
                    <input type="password" id="signup-password" name="password" required>
                </div>
                <div class="form-group">
                    <label for="signup-confirm-password">Confirm Password:</label>
                    <input type="password" id="signup-confirm-password" name="confirm-password" required>
                </div>
                <button type="submit" class="submit-btn">Sign Up</button>
            </form>
            <div class="toggle-form">
                <p>Already have an account? <button class="toggle-btn" onclick="toggleForms()">Login</button></p>
            </div>
        </div>

        <!-- Role Selection Form -->
        <div id="roleSelectionForm" class="form-container">
            <h2>Welcome!</h2>
            <p>Please select your role to continue</p>
            <div class="role-options">
                <div class="role-card" onclick="selectRole('farmer')">
                    <img src="farmer-icon.png" alt="Farmer">
                    <h3>Farmer</h3>
                    <p>I want to sell products</p>
                </div>
                <div class="role-card" onclick="selectRole('customer')">
                    <img src="customer-icon.png" alt="Customer">
                    <h3>Customer</h3>
                    <p>I want to buy products</p>
                </div>
            </div>
            <button class="back-btn" onclick="backToLogin()">Back to Login</button>
        </div>
    </div>

    <script>
        const loginForm = document.getElementById('loginForm');
        const signupForm = document.getElementById('signupForm');
        const roleSelectionForm = document.getElementById('roleSelectionForm');
        const loginFormElement = document.getElementById('loginFormElement');

        function toggleForms() {
            loginForm.classList.toggle('active');
            signupForm.classList.toggle('active');
        }

        function showRoleSelection() {
            loginForm.classList.remove('active');
            signupForm.classList.remove('active');
            roleSelectionForm.style.display = 'block';
        }

        function backToLogin() {
            roleSelectionForm.style.display = 'none';
            loginForm.classList.add('active');
            
            // Restore the credentials from sessionStorage
            const email = sessionStorage.getItem('currentUserEmail');
            const password = sessionStorage.getItem('currentUserPassword');
            
            if (email && password) {
                document.getElementById('login-email').value = email;
                document.getElementById('login-password').value = password;
            }
        }

        // Signup form submission
        document.querySelector('#signupForm form').addEventListener('submit', function(e) {
            e.preventDefault();
            const fullname = document.getElementById('signup-fullname').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const confirmPassword = document.getElementById('signup-confirm-password').value;
            
            if (password !== confirmPassword) {
                alert('Passwords do not match!');
                return;
            }
            
            if (fullname && email && password) {
                // Store the user credentials
                localStorage.setItem('registeredUsers', JSON.stringify([{
                    fullname: fullname,
                    email: email,
                    password: password
                }]));
                
                alert('Registration successful! Please login with your credentials.');
                this.reset();
                toggleForms();
                document.getElementById('login-email').value = email;
            }
        });

        // Modified login form submission
        loginFormElement.addEventListener('submit', function(e) {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            // Get the latest registered users from localStorage
            const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers')) || [];
            
            // Check if credentials match any registered user
            const user = registeredUsers.find(user => 
                user.email === email && user.password === password
            );
            
            if (user) {
                // Store the validated user info before showing role selection
                sessionStorage.setItem('currentUserEmail', email);
                sessionStorage.setItem('currentUserPassword', password);
                showRoleSelection();
            } else {
                alert('Invalid email or password. Please try again or sign up.');
            }
        });

        function selectRole(role) {
            // Store both email and password in sessionStorage before redirecting
            const currentEmail = document.getElementById('login-email').value;
            const currentPassword = document.getElementById('login-password').value;
            sessionStorage.setItem('currentUserEmail', currentEmail);
            sessionStorage.setItem('currentUserPassword', currentPassword);
            
            if (role === 'farmer') {
                window.location.href = 'farmer-dashboard.html';
            } else {
                window.location.href = 'customer-dashboard.html';
            }
        }

        // Modified function to restore both email and password
        function checkReturnUser() {
            const returnEmail = sessionStorage.getItem('currentUserEmail');
            const returnPassword = sessionStorage.getItem('currentUserPassword');
            
            if (returnEmail) {
                document.getElementById('login-email').value = returnEmail;
                document.getElementById('login-password').value = returnPassword;
                // Clear the session storage
                sessionStorage.removeItem('currentUserEmail');
                sessionStorage.removeItem('currentUserPassword');
            }
        }

        // Call this function when page loads
        window.addEventListener('load', checkReturnUser);
    </script>
</body>
</html> 
